<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link
      rel="preconnect"
      href="https://fonts.googleapis.com" />
    <link
      rel="preconnect"
      href="https://fonts.gstatic.com"
      crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kanit:ital,wght@0,200;0,400;0,700;1,700&family=Merriweather:wght@400;700&display=swap"
      rel="stylesheet" />
    <link rel="stylesheet" href="/styles/tokens.css" />
    <link rel="stylesheet" href="/styles/page.css" />
    <link rel="stylesheet" href="/styles/itinerary.css" />
    <link rel="stylesheet" href="/styles/entourage.css" />
    <link rel="stylesheet" href="/styles/timings.css" />
    <script type="module">
      import {
        CalendarWidget,
        EntourageTable,
        ItineraryItem,
        MapMarker,
        MapWidget
      } from "/js/blazing.js";

      customElements.define("entourage-table", EntourageTable);
      customElements.define("calendar-widget", CalendarWidget);
      customElements.define("itinerary-item", ItineraryItem);
      customElements.define("map-marker", MapMarker);
      customElements.define("map-widget", MapWidget);
    </script>
  </head>
  <body>
    <header>
      <h1>Blazing Travels</h1>
      <p><%= it.name %></p>
    </header>

    <main class="page">
      <calendar-widget
        start-date="<%= it.startDate %>"
        end-date="<%= it.endDate %>">
      </calendar-widget>

      <map-widget src="/maps/italy.geo.json">
        <% it.destinations.forEach(function(dst, i){ %>

        <map-marker
          id="<%= `marker-destination-${i}` %>"
          lat="<%= dst.location.lat %>"
          lon="<%= dst.location.lon %>">
          <%= dst.name %>
        </map-marker>

        <% }) %>
      </map-widget>

      <section class="itinerary">
        <!-- outbound flight -->
        <%~ include("./partials/transportation.eta",
          it.entourage[0].outbound ) %>
        <!-- loop over destinations -->
        <% it.destinations.forEach(function(dst, i){ %>
        <!-- destination partial -->
        <%~ include("./partials/destination.eta", 
          {_i_: i, ...it.destinations[i]} ) %>
        <!-- transportation partial -->
        <% if ( i < it.transportation.length ) { %>
        <%~ include("./partials/transportation.eta",
          it.transportation[i]) %>
        <% } %>
        <!-- end loop destinations -->
        <% }) %>
        <!-- return flight -->
        <%~ include("./partials/transportation.eta",
          it.entourage[0].inbound) %>
      </section>

      <%~ include("./partials/entourage.eta", it.entourage) %>
    </main>
  </body>
</html>
